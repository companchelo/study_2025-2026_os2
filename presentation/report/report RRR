---
## Front matter
title: "Реферат"
subtitle: "Загружаемые модули ядра Linux (LKM): Гибкость и расширяемость ядра"
author: "Хохлачева Полина Дмитриевна"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"

## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Введение 

Ядро операционной системы Linux – это сложная и многогранная система, являющаяся
фундаментом для работы программ и взаимодействия с оборудованием. Традиционно, ядро
строилось по монолитной архитектуре, где все компоненты были жестко связаны между
собой. Однако, такой подход со временем стал ограничивать гибкость и расширяемость
системы. В современном Linux для решения этих проблем используется механизм
загружаемых модулей ядра (Loadable Kernel Modules, LKM).
LKM – это, простыми словами, кусочки кода, которые можно добавлять и убирать из ядра "на
ходу", не пересобирая и не перезагружая всю систему. Это очень удобно, когда нужно
добавить поддержку нового оборудования или реализовать какую-то специфическую
функцию.
В данном реферате, основываясь на доступной русскоязычной литературе и личном
понимании предмета как студентки 2-го курса, будет рассмотрена архитектура LKM,
принципы их работы, а также преимущества и недостатки использования этого механизма.
Также будут затронуты вопросы безопасности и альтернативные подходы к расширению
функциональности ядра.

# Что такое загружаемый модуль ядра?

Загружаемый модуль ядра (LKM) – это, по сути, скомпилированный файл, содержащий код,
который можно динамически загрузить в ядро Linux. В отличие от обычных программ, LKM не
запускается как отдельный процесс. Вместо этого, он становится частью ядра, разделяя его
память и ресурсы. Это позволяет LKM напрямую взаимодействовать с другими компонентами
ядра и с аппаратным обеспечением.
Важно понимать, что LKM – это не "черный ящик". Он должен быть написан в соответствии с
определенными правилами и использовать специальные интерфейсы, предоставляемые
ядром. Это гарантирует, что модуль сможет правильно работать и не приведет к сбоям в
системе.

# Структура загружаемого модуля ядра

LKM имеет определенную структуру, включающую в себя следующие ключевые элементы:
• Заголовочные файлы (include-файлы): Для разработки LKM необходимо использовать
специальные заголовочные файлы, предоставляемые ядром Linux. Эти файлы содержат
определения типов данных, структур и функций, необходимых для взаимодействия с ядром.
Наиболее важным является файл <linux/module.h>, который содержит основные функции для
работы с модулями.
• Функция инициализации (init-функция): Эта функция вызывается при загрузке модуля в
ядро. В ней обычно выполняется настройка модуля, выделение памяти, регистрация
обработчиков прерываний и другие необходимые действия. Функция инициализации должна
возвращать код успеха или код ошибки, чтобы ядро могло определить, успешно ли была
загрузка модуля.
• Функция завершения (exit-функция): Эта функция вызывается при выгрузке модуля из ядра.
В ней обычно освобождается выделенная память, отменяется регистрация обработчиков
прерываний и выполняются другие действия, необходимые для корректного завершения
работы модуля.
• Лицензионная информация: Каждый LKM должен содержать информацию о своей
лицензии. Это необходимо для обеспечения совместимости с лицензией GNU General Public
License (GPL), под которой распространяется ядро Linux.
• Метаданные: LKM также может содержать метаданные, такие как имя автора, описание
модуля, версия и другая полезная информация.

# Процесс загрузки и выгрузки модуля

Для управления LKM в Linux используются специальные утилиты командной строки, такие как
insmod, rmmod и modprobe.
• insmod (insert module): Эта утилита используется для загрузки модуля в ядро. Она
принимает в качестве аргумента имя объектного файла модуля и загружает его в память.
Однако, insmod не умеет автоматически разрешать зависимости между модулями.
• rmmod (remove module): Эта утилита используется для выгрузки модуля из ядра. Она
принимает в качестве аргумента имя модуля и выгружает его из памяти. Однако, rmmod не
сможет выгрузить модуль, если он используется другими компонентами системы.
• modprobe: Это более мощна
я и удобная утилита для управления модулями. Она не только загружает и выгружает модули,
но и автоматически разрешает зависимости между ними. modprobe использует файлы
конфигурации, расположенные в каталоге /etc/modprobe.d/, для определения зависимостей
модулей.
Процесс загрузки модуля с использованием modprobe выглядит примерно так:
1. Утилита modprobe ищет объектный файл модуля.
2. modprobe анализирует зависимости модуля и загружает все необходимые модули, от
которых он зависит.
3. Объектный файл модуля загружается в память ядра.
4. Вызывается функция инициализации модуля.
5. Модуль регистрируется в системе.
Процесс выгрузки модуля происходит в обратном порядке.

# Преимущества использования загружаемых модулей ядра

Использование LKM предоставляет ряд значительных преимуществ:
• Уменьшение размера ядра: Загружаются только необходимые модули, что уменьшает
размер ядра и экономит память. Это особенно важно для встраиваемых систем, где ресурсы
ограничены.
• Гибкость и адаптивность: Можно добавлять и удалять функциональность ядра "на ходу", без
перезагрузки системы. Это позволяет адаптировать систему под конкретные нужды.
• Упрощение разработки и отладки: Разрабатывать и отлаживать LKM проще, чем
разрабатывать и отлаживать все ядро целиком.
• Расширяемость: Легко добавлять поддержку нового оборудования и новых функций, не
изменяя основное ядро.

# Примеры использования загружаемых модулей ядра

LKM используются в Linux повсеместно. Вот несколько примеров:
• Драйверы устройств: Большинство драйверов устройств, таких как драйверы сетевых карт,
видеокарт, звуковых карт и USB-устройств, реализованы в виде LKM.
• Файловые системы: Поддержка различных файловых систем (ext4, XFS, NTFS) также
реализуется с помощью LKM.• Сетевые протоколы: Поддержка различных сетевых протоколов может быть реализована с
помощью LKM.
• Модули безопасности: Некоторые модули безопасности, такие как AppArmor и SELinux,
также могут быть реализованы как LKM.

# Проблемы и недостатки использования загружаемых модулей ядра

Несмотря на свои преимущества, LKM имеют и некоторые недостатки:
• Безопасность: LKM работают в пространстве ядра, поэтому любая ошибка или уязвимость
в модуле может привести к компрометации всей системы.
• Совместимость: Модули должны быть скомпилированы для конкретной версии ядра.
Использование модуля, скомпилированного для другой версии ядра, может привести к
проблемам.
• Стабильность: Неправильно написанный модуль может привести к сбоям в работе
системы.

# Заключение

Загружаемые модули ядра Linux (LKM) являются мощным инструментом, позволяющим
динамически расширять функциональность ядра и адаптировать его под конкретные нужды.
Однако, необходимо помнить о проблемах безопасности и соблюдать осторожность при
разработке и использовании LKM.
Несмотря на появление альтернативных подходов, таких как eBPF, LKM продолжают играть
важную роль в экосистеме Linux. Понимание принципов работы LKM необходимо для любого,
кто занимается админис
трированием Linux-систем или разработкой драйверов устройств.

# Список литературы

* Хабр (habr.com)
* Linux.org.ru (linux.org.ru)
• Книги по администрированию Linux
• Документация ядра Linux






